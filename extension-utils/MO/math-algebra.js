/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/nerdamer@1.1.13/Algebra.js
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
if("undefined"!=typeof module){var nerdamer=require("./nerdamer.core.js");require("./Calculus.js")}!function(){"use strict";var e=nerdamer.getCore(),r=e.PARSER,t=e.groups.N,i=e.groups.P,n=e.groups.S,a=e.groups.EX,o=e.groups.FN,s=e.groups.PL,l=e.groups.CP,u=e.groups.CB,f=e.Utils.keys,c=e.Utils.even,p=e.Utils.variables,h=e.Utils.format,m=e.Utils.round,v=e.Frac,d=e.Utils.isInt,g=e.Symbol,b=e.Settings.CONST_HASH,y=e.Utils.importFunctions();e.Utils.evaluate;function w(t,i,n){if(e.Utils.isSymbol(t))this.parse(t),this.variable=this.variable||i;else if(isNaN(t))"string"==typeof t&&this.parse(r.parse(t));else{if(n=n||0,void 0===i)throw new e.exceptions.InvalidVariableNameError("Polynomial expects a variable name when creating using order");this.coeffs=[],this.coeffs[n]=t,this.fill(t)}}function M(){this.factors={},this.length=0}function S(r,t,i){this.terms=t||[],this.coeff=r,this.map=i,this.sum=new e.Frac(0),this.image=void 0}w.fromArray=function(r,t){if(void 0===t)throw new e.exceptions.InvalidVariableNameError("A variable name must be specified when creating polynomial from array");var i=new w;return i.coeffs=r,i.variable=t,i},w.fit=function(e,r,t,i,n,a){var o=new Array(n+1),s=t-r;o[0]=r,o[n]=e,s-=e*Math.pow(i,n);for(var l=n-1;l>0;l--){var u=Math.pow(i,l),f=s/u,c=Math.sign(f)*Math.floor(Math.abs(f));s-=c*u,o[l]=c}if(0!==s)return null;for(l=0;l<o.length;l++)o[l]=new v(o[l]);return w.fromArray(o,a)},w.prototype={parse:function(i,n){if(this.variable=p(i)[0],!i.isPoly())throw e.exceptions.NerdamerTypeError("Polynomial Expected! Received "+e.Utils.text(i));if(n=n||[],i.power.absEquals(1)||(i=r.expand(i)),i.group===e.groups.N)n[0]=i.multiplier;else if(i.group===e.groups.S)n[i.power.toDecimal()]=i.multiplier;else for(var a in i.symbols){var o=i.symbols[a],s=o.power;if(e.Utils.isSymbol(s))throw new e.exceptions.NerdamerTypeError("power cannot be a Symbol");s=o.group===t?0:s.toDecimal(),o.symbols?this.parse(o,n):n[s]=o.multiplier}this.coeffs=n,this.fill()},fill:function(e){e=Number(e)||0;for(var r=this.coeffs.length,t=0;t<r;t++)void 0===this.coeffs[t]&&(this.coeffs[t]=new v(e));return this},trim:function(){for(var e=this.coeffs.length;e--;){var r=this.coeffs[e],t=r.equals(0);if(!r||!t)break;if(0===e)break;this.coeffs.pop()}return this},modP:function(e){for(var r=this.coeffs.length,t=0;t<r;t++){var i=this.coeffs[t];if(i<0){for(var n,a=t;a<r;a++)if(this.coeffs[a]>0){n=this.coeffs[a];break}if(n){for(;a>t;a--)this.coeffs[a]=this.coeffs[a].subtract(new v(1)),this.coeffs[a-1]=this.coeffs[a-1].add(new v(e));i=this.coeffs[t]}}var o=i.mod(e),s=i.subtract(o).divide(e);if(!s.equals(0)){var l=t+1,u=this.coeffs[l]||new v(0);u=u.add(s),this.coeffs[l]=new v(u),this.coeffs[t]=new v(o)}}return this},add:function(e){for(var r=Math.max(this.coeffs.length,e.coeffs.length),t=0;t<r;t++){var i=this.coeffs[t]||new v(0),n=e.coeffs[t]||new v(0);this.coeffs[t]=i.add(n)}return this},subtract:function(e){for(var r=Math.max(this.coeffs.length,e.coeffs.length),t=0;t<r;t++){var i=this.coeffs[t]||new v(0),n=e.coeffs[t]||new v(0);this.coeffs[t]=i.subtract(n)}return this},divide:function(r){for(var t=this.variable,i=e.Utils.arrayClone(this.coeffs),n=e.Utils.arrayClone(r.coeffs),a=i.length,o=n.length-1,s=[],l=0;l<a;l++){var u=a-(l+1),f=u-o,c=i[u].divide(n[o]);if(f<0)break;s[f]=c;for(var p=0;p<=o;p++)i[p+f]=i[p+f].subtract(n[p].multiply(c))}var h=w.fromArray(i,t||"x").trim();return[w.fromArray(s,t||"x"),h]},multiply:function(e){for(var r=this.coeffs.length,t=e.coeffs.length,i=[],n=0;n<r;n++)for(var a=this.coeffs[n],o=0;o<t;o++){var s=n+o,l=e.coeffs[o],u=i[s]||new v(0);i[s]=u.add(a.multiply(l))}return this.coeffs=i,this},isZero:function(){for(var e=this.coeffs.length,r=0;r<e;r++){if(!this.coeffs[r].equals(0))return!1}return!0},sub:function(e){for(var r=new v(0),t=this.coeffs.length,i=0;i<t;i++){var n=this.coeffs[i];n.equals(0)||(r=r.add(n.multiply(new v(Math.pow(e,i)))))}return r},clone:function(){var e=new w;return e.coeffs=this.coeffs,e.variable=this.variable,e},deg:function(){return this.trim(),this.coeffs.length-1},lc:function(){return this.coeffs[this.deg()].clone()},monic:function(){for(var e=this.lc(),r=this.coeffs.length,t=0;t<r;t++)this.coeffs[t]=this.coeffs[t].divide(e);return this},gcd:function(r){if(this.coeffs.length-1<r.coeffs.length-1)return r.gcd(this);for(var t=this;!r.isZero();){var i=r.clone();r=(t=t.clone()).divide(i)[1],t=i}var n=e.Math2.QGCD.apply(null,t.coeffs);if(!n.equals(1))for(var a=t.coeffs.length,o=0;o<a;o++)t.coeffs[o]=t.coeffs[o].divide(n);return t},diff:function(){for(var e=[],r=this.coeffs.length,t=1;t<r;t++)e.push(this.coeffs[t].multiply(new v(t)));return this.coeffs=e,this},integrate:function(){for(var e=[0],r=this.coeffs.length,t=0;t<r;t++){var i=new v(t+1);e[i]=this.coeffs[t].divide(i)}return this.coeffs=e,this},gcf:function(r){for(var t=[],i=0;i<this.coeffs.length;i++){var n=this.coeffs[i];n.equals(0)||-1!==t.indexOf(n)||t.push(n)}var a=[e.Math2.QGCD.apply(void 0,t),function(e){for(var r=0;r<e.length;r++)if(!e[r].equals(0))return r}(this.coeffs)].toDecimal();if(r){var o=[];o[a[1]-1]=a[0],a=w.fromArray(o,this.variable).fill()}return a},quad:function(e){var r=[];if(this.coeffs.length>3)throw new Error("Cannot calculate quadratic order of "+(this.coeffs.length-1));if(0===this.coeffs.length)throw new Error("Polynomial array has no terms");var t=this.coeffs[2]||0,i=this.coeffs[1]||0,n=i*i-4*t*this.coeffs[0];return n<0&&!e||(r[0]=(-i+Math.sqrt(n))/(2*t),r[1]=(-i-Math.sqrt(n))/(2*t)),r},squareFree:function(){for(var e=this.clone(),r=1,t=e.clone().diff(),i=e.clone().gcd(t),n=e.divide(i)[0],a=w.fromArray([new v(1)],e.variable);!i.equalsNumber(1);){var o=n.gcd(i),s=n.divide(o)[0];if(!s.equalsNumber(1)&&r>1){for(var l=s.clone(),u=1;u<r;u++)l.multiply(s.clone());s=l}a=a.multiply(s),r++,n=o,i=i.divide(o)[0]}return[a,n,r]},toSymbol:function(){var t=this.coeffs.length,i=this.variable;if(0===t)return new e.Symbol(0);for(var n=t-1,a="",o=0;o<t;o++){var s=o===n?"":"+",l=this.coeffs[o];l.equals(0)||(a+=l+"*"+i+"^"+o+s)}return r.parse(a)},equalsNumber:function(e){return this.trim(),1===this.coeffs.length&&this.coeffs[0].toDecimal()===String(e)},toString:function(){return this.toSymbol().toString()}},g.prototype.coeffs=function(e,t){t&&!this.isPoly(!0)&&r.error("Polynomial expected when requesting coefficients with order"),e=e||[];var i=this.clone().distributeMultiplier();if(i.isComposite())for(var n in i.symbols){var a=i.symbols[n];a.isComposite()?a.clone().distributeMultiplier().coeffs(e,t):t?e[a.isConstant()?0:a.power.toDecimal()]=a.multiplier:e.push(a.multiplier)}else if(t)e[i.isConstant(!0)?0:i.power.toDecimal()]=i.multiplier;else if(i.group===u&&i.isImaginary()){var o=new g(i.multiplier);i.each((function(e){(e.isConstant(!0)||e.imaginary)&&(o=r.multiply(o,e))})),e.push(o)}else e.push(i.multiplier);if(t)for(var s=0;s<e.length;s++)void 0===e[s]&&(e[s]=new g(0));return e},g.prototype.tBase=function(e){if(void 0===e)throw new Error("Symbol.tBase requires a map object!");for(var r=[],t=this.collectSymbols(null,null,null,!0),i=t.length,n=0;n<i;n++){var a=t[n],o=a.group,s=new S(a.multiplier,[],e);if(o===u)for(var l in a.symbols){var f=a.symbols[l];s.terms[e[l]]=f.power}else s.terms[e[a.value]]=a.power;r.push(s.fill()),s.updateCount()}return r},g.prototype.altVar=function(e){var r=this.multiplier.toString(),t=this.power.toString();return("1"===r?"":r+"*")+e+("1"===t?"":"^"+t)},g.prototype.sameVars=function(e){if(!this.symbols&&this.group!==e.group)return!1;for(var r in this.symbols){var t=this.symbols[r],i=e.symbols[r];if(!i)return!1;if(t.value!==i.value)return!1}return!0},g.prototype.groupTerms=function(t){var i,n,a;t=String(t);var o=[];return this.each((function(l){if(l.group===s){a=l.groupTerms(t);for(var u=0;u<a.length;u++){var f=a[u];f&&(o[u]=f)}}else i=e.Utils.decompose_fn(l,t,!0),n=i.x.value===t?Number(i.x.power):0,o[n]=r.add(o[n]||new g(0),i.a)})),o},g.prototype.collectFactors=function(){var e=[];return this.group===u?this.each((function(r){e.push(r.clone())})):e.push(this.clone()),e},M.prototype.getNumberSymbolics=function(){var e=0;return this.each((function(r){r.isConstant(!0)||e++})),e},M.prototype.add=function(t){if(t.equals(0))return this;if(t.equals(-1)&&this.length>0){var i=e.Utils.firstObject(this.factors,null,!0);return this.add(r.symfunction(e.Settings.PARENTHESIS,[i.obj]).negate()),delete this.factors[i.key],this.length--,this}if(t.group===u){var n=this;t.multiplier.equals(1)||n.add(new g(t.multiplier)),t.each((function(e){n.add(e)}))}else{this.preAdd&&(t=this.preAdd(t)),this.pFactor&&(t=r.pow(t,new g(this.pFactor)));var a=t.isConstant();if(a&&t.equals(1))return this;var o=a?t.value:t.text();o in this.factors?(this.factors[o]=r.multiply(this.factors[o],t),this.factors[o].equals(1)&&(delete this.factors[o],this.length--)):(this.factors[o]=t,this.length++)}return this},M.prototype.toSymbol=function(){for(var t=new g(1),i=Object.values(this.factors).sort((function(e,r){return e.group>r.group})),n=0,a=i.length;n<a;n++){var o=i[n],s=o.power.equals(1)&&""!==o.fname?r.symfunction(e.PARENTHESIS,[o]):o;t=r.multiply(t,s)}return""===t.fname&&(t=g.unwrapPARENS(t)),t},M.prototype.merge=function(e){for(var t in e)t in this.factors?this.factors[t]=r.multiply(this.factors[t],e[t]):this.factors[t]=e[t];return this},M.prototype.each=function(r){for(var t in this.factors){var i=this.factors[t];i.fname===e.PARENTHESIS&&i.isLinear()&&(i=i.args[0]),r.call(this,i,t)}return this},M.prototype.count=function(){return f(this.factors).length},M.prototype.clean=function(){try{var r=e.Settings.CONST_HASH;this.factors[r].lessThan(0)&&(this.factors[r].equals(-1)?delete this.factors[r]:this.factors[r].negate(),this.each((function(e){e.negate()})))}catch(e){}},M.prototype.toString=function(){return this.toSymbol().toString()},S.prototype.updateCount=function(){this.count=this.count||0;for(var e=0;e<this.terms.length;e++)this.terms[e].equals(0)||this.count++;return this},S.prototype.getVars=function(){for(var e=[],r=0;r<this.terms.length;r++){var t=this.terms[r];this.getRevMap();t.equals(0)||e.push(this.rev_map[r])}return e.join(" ")},S.prototype.len=function(){return void 0===this.count&&this.updateCount(),this.count},S.prototype.toSymbol=function(e){e=e||this.getRevMap();for(var t=new g(this.coeff),i=0;i<this.terms.length;i++){var n=e[i],a=this.terms[i];if(!a.equals(0)&&n!==b){var o=new g(n);o.power=a,t=r.multiply(t,o)}}return t},S.prototype.getRevMap=function(){if(this.rev_map)return this.rev_map;var e={};for(var r in this.map)e[this.map[r]]=r;return this.rev_map=e,e},S.prototype.generateImage=function(){return this.image=this.terms.join(" "),this},S.prototype.getImg=function(){return this.image||this.generateImage(),this.image},S.prototype.fill=function(){for(var r=this.map.length,t=0;t<r;t++)void 0===this.terms[t]?this.terms[t]=new e.Frac(0):this.sum=this.sum.add(this.terms[t]);return this},S.prototype.divide=function(e){for(var r=this.coeff.divide(e.coeff),t=this.terms.length,i=new S(r,[],this.map),n=0;n<t;n++)i.terms[n]=this.terms[n].subtract(e.terms[n]),i.sum=i.sum.add(i.terms[n]);return i},S.prototype.multiply=function(e){for(var r=this.coeff.multiply(e.coeff),t=this.terms.length,i=new S(r,[],this.map),n=0;n<t;n++)i.terms[n]=this.terms[n].add(e.terms[n]),i.sum=i.sum.add(i.terms[n]);return i},S.prototype.isZero=function(){return this.coeff.equals(0)},S.prototype.toString=function(){return"{ coeff: "+this.coeff.toString()+", terms: ["+this.terms.join(",")+"]: sum: "+this.sum.toString()+", count: "+this.count+"}"},e.Utils.toMapObj=function(e){for(var r=0,t={},i=0;i<e.length;i++){var n=e[i];void 0===t[n]&&(t[n]=r,r++)}return t.length=r,t},e.Utils.filledArray=function(e,r,t){for(var i=[];r--;)i[r]=t?new t(e):e;return i},e.Utils.arrSum=function(e){for(var r=0,t=e.length,i=0;i<t;i++)r+=e[i];return r},e.Utils.haveIntersection=function(e,r){var t;return r.length>e.length&&(t=r,r=e,e=t),e.some((function(e){return r.indexOf(e)>-1}))},e.Utils.subFunctions=function(r,t){t=t||{};var i=[];return r.each((function(r){if(r.group===o||r.previousGroup===o){var n=e.Utils.text(r,"hash"),a=t[n];if(a)i.push(r.altVar(a));else{var c=r.fname+f(t).length;t[n]=c,i.push(r.altVar(c))}}else r.group===u||r.group===s||r.group===l?i.push(e.Utils.subFunctions(r,t)):i.push(r.text())})),r.group===l||r.group===s?r.altVar(e.Utils.inBrackets(i.join("+"))):r.group===u?r.altVar(e.Utils.inBrackets(i.join("*"))):r.text()},e.Utils.getFunctionsSubs=function(e){var t={};for(var i in e)t[e[i]]=r.parse(i);return t};var q=e.Algebra={version:"1.4.6",proots:function(t,i){i=i||7;var a=[],o=function(e,r,t){for(var i=A(e,r,t).concat(a),n=0;n<0;n++)i.unshift(0);return i};if(t instanceof g&&t.isPoly()){if(t.distributeMultiplier(),t.group===s){var l=e.Utils.arrayMin(f(t.symbols)),u=t.symbols[l].clone().toUnitMultiplier();t=r.expand(r.divide(t,u)),a.push(0)}if(t.group===e.groups.S)return[0];if(t.group===e.groups.PL){var c=f(t.symbols),p=e.Utils.arrayMin(c);t=e.PARSER.divide(t,e.PARSER.parse(t.value+"^"+p))}for(var h=f(t.symbols).sort().pop(),v=t.group===e.groups.PL?t.symbols:t.symbols[h],d=v.group,y=(c=d===n?[v.power.toDecimal()]:f(v.symbols),[]),w=e.Utils.arrayMax(c),M=1;M<=w;M++){var S=0;-1!==c.indexOf(M+"")&&(S=d===n?v.multiplier:v.symbols[M].multiplier),y.unshift(S)}return y.push(t.symbols[b].multiplier),v.group===n&&(y[0]=v.multiplier),o(y,c,w)}if(e.Utils.isArray(t)){var q=t,U=(y=[],c=[],0);for(M=0;M<q.length;M++){for(var F=q[M][0],x=q[M][1],N=x-U-1,C=0;C<N;C++)y.unshift(0);y.unshift(F),0!==x&&c.push(x),U=x}return o(y,c,w=Math.max.apply(void 0,c))}throw new e.exceptions.NerdamerTypeError("Cannot calculate roots. Symbol must be a polynomial!");function A(r,t,n){var a=r.slice(0);if(r.unshift(n),n>100)throw new e.exceptions.ValueLimitExceededError("This utility accepts polynomials of degree up to 100. ");var o=[],s={};for(s.Degree=n,M=0;M<n;M++)o.push(0);var l=o.slice(0);function u(e,r,t,i,n,a){n[0]=a.b=i[0],n[1]=a.a=-r*a.b+i[1];for(var o=2;o<e;o++)n[o]=-(r*a.a+t*a.b)+i[o],a.b=a.a,a.a=n[o]}function f(e,r,t,i,n,a,o,s,l){var f=new Object,c=3;return f.b=f.a=0,u(r,o,s,a,l,f),n.c=f.a,n.d=f.b,Math.abs(n.c)<=100*e*Math.abs(a[r-1])&&Math.abs(n.d)<=100*e*Math.abs(a[r-2])||(n.h=s*i,Math.abs(n.d)>=Math.abs(n.c)?(c=2,n.e=t/n.d,n.f=n.c/n.d,n.g=o*i,n.a3=n.e*(n.g+t)+n.h*(i/n.d),n.a1=-t+n.f*i,n.a7=n.h+(n.f+o)*t):(c=1,n.e=t/n.c,n.f=n.d/n.c,n.g=n.e*o,n.a3=n.e*t+(n.g+n.h/n.c)*i,n.a1=-t*(n.d/n.c)+i,n.a7=n.g*n.d+n.h*n.f+t)),c}function c(e,r,t,i,n,a,o,s,l){var u;if(3!=t)if(u=1==t?n:i,Math.abs(a.a1)>10*e*Math.abs(u)){a.a7/=a.a1,a.a3/=a.a1,o[0]=l[0],o[1]=-l[0]*a.a7+l[1];for(f=2;f<r;f++)o[f]=-l[f-1]*a.a7+s[f-2]*a.a3+l[f]}else{o[0]=0,o[1]=-l[0]*a.a7;for(f=2;f<r;f++)o[f]=-l[f-1]*a.a7+s[f-2]*a.a3}else{o[1]=o[0]=0;for(var f=2;f<r;f++)o[f]=s[f-2]}}function p(e,r,t,i,n,a,o,s,l,u,f,c,p,h,m,v,d){var g,b,y,w,M,S,q,U;r.b=r.a=0,3!=e&&(2!=e?(g=t+p*o+c*u,b=s+(p+h*u)*l):(g=(t+f)*u+c,b=(u+p)*s+h*l),0!=(U=-(q=-((M=(y=-m[v-1]/d[v])*a)+(S=y*y*n))+h*(w=-(m[v-2]+y*d[v-1])/d[v])*i)+b+y*g)&&(r.a=-(p*(S+M)+h*(y*i+w*a))/U+p,r.b=h*(1+q/U)))}function h(e,r,t,i){var n,a,o;i.sr=i.si=i.lr=i.li=0,0!=e?0!=t?(n=r/2,Math.abs(n)<Math.abs(t)?(o=-(o=t>=0?e:-e)+n*(n/Math.abs(t)),a=Math.sqrt(Math.abs(o))*Math.sqrt(Math.abs(t))):(o=-e/n*(t/n)+1,a=Math.sqrt(Math.abs(o))*Math.abs(n)),o>=0?(a=n>=0?-a:a,i.lr=(-n+a)/e,i.sr=0!=i.lr?t/i.lr/e:i.sr):(i.lr=i.sr=-n/e,i.si=Math.abs(a/e),i.li=-i.si)):i.lr=-r/e:i.sr=0!=r?-t/r:i.sr}function v(e,r,t,i,n,a,o,s,l,m,v,d){var g,b,y,w,M,S,q,U,F,x,N,C=new Object,A=0,E=0;t.NZ=0,S=i,U=n;do{if(C.li=C.lr=C.si=C.sr=0,h(1,S,U,C),t.szr=C.sr,t.szi=C.si,t.lzr=C.lr,t.lzi=C.li,Math.abs(Math.abs(t.szr)-Math.abs(t.lzr))>.01*Math.abs(t.lzr))break;for(u(o,S,U,l,a,s),b=Math.abs(-t.szr*s.b+s.a)+Math.abs(t.szi*s.b),x=Math.sqrt(Math.abs(U)),g=2*Math.abs(a[0]),M=-t.szr*s.b,N=1;N<r;N++)g=g*x+Math.abs(a[N]);if(b<=20*(g=(9*(g=g*x+Math.abs(M+s.a))+2*Math.abs(M)-7*(Math.abs(s.a+M)+x*Math.abs(s.b)))*e)){t.NZ=2;break}if(++A>20)break;if(A>=2&&w<=.01&&b>=y&&!E){for(u(o,S-=S*(w=w<e?Math.sqrt(e):Math.sqrt(w)),U+=U*w,l,a,s),N=0;N<5;N++)c(e,r,f(e,r,s.a,s.b,v,d,S,U,m),s.a,s.b,v,d,m,a);E=1,A=0}y=b,c(e,r,f(e,r,s.a,s.b,v,d,S,U,m),s.a,s.b,v,d,m,a),p(f(e,r,s.a,s.b,v,d,S,U,m),s,s.a,v.a1,v.a3,v.a7,s.b,v.c,v.d,v.f,v.g,v.h,S,U,d,r,l),q=s.a,0!=(F=s.b)&&(w=Math.abs((-U+F)/F),S=q,U=F)}while(0!=F)}function d(e,r,t,i,n,a,o,s,l){var u,f,c,p,h,m,v,d,g,b,y,w=i-1;for(r.NZ=y=g=0,v=t.a;;){for(m=n[0],o[0]=m,b=1;b<a;b++)o[b]=m=m*v+n[b];for(c=Math.abs(m),p=Math.abs(v),u=.5*Math.abs(o[0]),b=1;b<a;b++)u=u*p+Math.abs(o[b]);if(c<=20*e*(2*u-c)){r.NZ=1,r.szr=v,r.szi=0;break}if(++y>10)break;if(y>=2&&Math.abs(d)<=.001*Math.abs(-d+v)&&c>h){g=1,r.a=v;break}for(h=c,l[0]=f=s[0],b=1;b<i;b++)l[b]=f=f*v+s[b];if(Math.abs(f)>10*Math.abs(s[w])*e)for(d=-m/f,s[0]=o[0],b=1;b<i;b++)s[b]=d*l[b-1]+o[b];else for(s[0]=0,b=1;b<i;b++)s[b]=l[b-1];for(f=s[0],b=1;b<i;b++)f=f*v+s[b];v+=d=Math.abs(f)>10*Math.abs(s[w])*e?-m/f:0}return g}function g(e,r,t,i,n,a,o,s,l,h,m,g){var b,y,w,M,S,q,U,F,x,N,C,A,E,D,P,k,T,I,L,R,V,_,z,j,O,Z=new Object,G=new Object,B=new Array(r),H=new Array(r),Q=1;for(g.NZ=0,M=w=.25,S=i,F=n,Z.b=Z.a=0,u(l,m,n,s,h,Z),b=Z.a,y=Z.b,G.h=G.g=G.f=G.e=G.d=G.c=G.a7=G.a3=G.a1=0,z=f(e,o,b,y,G,a,m,n,B),R=0;R<t;R++){if(I=1,c(e,o,z,b,y,G,a,B,h),p(z=f(e,o,b,y,G,a,m,n,B),Z,b,G.a1,G.a3,G.a7,y,G.c,G.d,G.f,G.g,G.h,m,n,a,o,s),P=Z.a,T=k=Z.b,N=0!=a[o-1]?-s[o]/a[o-1]:0,C=E=1,0!=R&&3!=z&&(j=(D=(E=0!=T?Math.abs((T-F)/T):E)<U?E*U:1)<M?1:0,(V=(A=(C=0!=N?Math.abs((N-S)/N):C)<q?C*q:1)<w?1:0)||j)){for(L=0;L<o;L++)H[L]=a[L];for(x=N,_=O=0;;){if(I&&0==(I=0)&&V&&(!j||A<D));else{if(v(e,o,g,P,k,h,l,Z,s,B,G,a),b=Z.a,y=Z.b,g.NZ>0)return;if(Q=O=1,M*=.25,_||!V)Q=0;else for(L=0;L<o;L++)a[L]=H[L]}if(0!=Q){if(Z.a=x,Q=d(e,g,Z,o,s,l,h,a,B),x=Z.a,g.NZ>0)return;if(_=1,w*=.25,0!=Q){P=-(x+x),k=x*x;continue}}for(L=0;L<o;L++)a[L]=H[L];if(!j||O)break}u(l,m,n,s,h,Z),z=f(e,o,b=Z.a,y=Z.b,G,a,m,n,B)}F=T,S=N,U=E,q=C}}!function(e,r,t,i){var n,a,o,s,l,u,f,c,p,m,v,d,b,y,w,M,S,q,U,F,x,N,C,A=e.Degree,E=.017453292519943295,D=Math.LN2,P=e.Degree+1,k=new Array(P),T=new Array(P),I=new Array(P),L=new Array(P),R=new Object,V=new Object;d=1;do{a=d,b=1+(d/=2)}while(b>1);var _=Number.MIN_VALUE/a,z=Math.cos(94*E),j=Math.sin(94*E),O=Math.sqrt(.5),Z=-O;for(V.NZ=q=0,V.szr=V.szi=V.lzr=V.lzi=0;0==r[A];)t[q]=i[q]=0,A--,q++;for(N=A+1;A>=1;){if(A<=2){A<2?(t[e.Degree-1]=-r[1]/r[0],i[e.Degree-1]=0):(R.li=R.lr=R.si=R.sr=0,h(r[0],r[1],r[2],R),t[e.Degree-2]=R.sr,i[e.Degree-2]=R.si,t[e.Degree-1]=R.lr,i[e.Degree-1]=R.li);break}for(f=0,c=Number.MAX_VALUE,G=0;G<N;G++)(m=Math.abs(r[G]))>f&&(f=m),0!=m&&m<c&&(c=m);if(((p=_/c)<=1&&f>=10||p>1&&Number.MAX_VALUE/p>=f)&&(p=0==p?Number.MIN_VALUE:p,F=Math.floor(Math.log(p)/D+.5),1!=(l=Math.pow(2,F))))for(G=0;G<N;G++)r[G]*=l;for(var G=0;G<N;G++)T[G]=Math.abs(r[G]);T[A]=-T[A],x=A-1,m=Math.exp((Math.log(-T[A])-Math.log(T[0]))/A),0!=T[x]&&(m=(v=-T[A]/T[x])<m?v:m),v=m;do{v=.1*(m=v),u=T[0];for(G=1;G<N;G++)u=u*v+T[G]}while(u>0);s=m;do{o=u=T[0];for(G=1;G<A;G++)o=m*o+(u=m*u+T[G]);m-=s=(u=m*u+T[A])/o}while(Math.abs(s/m)>.005);n=m;for(G=1;G<A;G++)k[G]=(A-G)*r[G]/A;for(k[0]=r[0],d=r[A],b=r[x],C=0==k[x]?1:0,U=0;U<5;U++)if(y=k[x],C){for(G=0;G<x;G++)k[q=x-G]=k[q-1];k[0]=0,C=0==k[x]?1:0}else{M=-d/y;for(G=0;G<x;G++)k[q=x-G]=M*k[q-1]+r[q];k[0]=r[0],C=Math.abs(k[x])<=Math.abs(b)*a*10?1:0}for(G=0;G<A;G++)L[G]=k[G];for(U=1;U<=20;U++){if(S=-j*Z+z*O,Z=j*O+z*Z,g(a,P,20*U,w=n*(O=S),n,k,A,r,N,I,-2*w,V),0!=V.NZ){t[q=e.Degree-A]=V.szr,i[q]=V.szi,A=(N-=V.NZ)-1;for(G=0;G<N;G++)r[G]=I[G];1!=V.NZ&&(t[q+1]=V.lzr,i[q+1]=V.lzi);break}for(G=0;G<A;G++)k[G]=L[G]}if(U>20){e.Degree-=A;break}}}(s,a,l,o);var b=o.length;for(M=0;M<b;M++){var y=m(o[M],i+8),w=m(l[M],i+8),S=y<0?"-":"";0===(w=i-String(w).length>2?w:l[M])&&(w=""),0===y&&(y=""),y=1===Math.abs(y)?S+"i":y?y+"*i":"";var q=w&&y?w+"+"+y:w+y;l[M]=q.replace(/\+\-/g,"-")}return l}},roots:function(t){if(t.isConstant(!0,!0))return e.Utils.nroots(t);var i=q.proots(t).map((function(e){return r.parse(e)}));return e.Vector.fromArray(i)},froot:function(r,t,i){return function(t){for(var n=i||e.Utils.build(e.Calculus.diff(r.clone())),a=r instanceof Function?r:e.Utils.build(r),o=!1,s=0;!o;){var l=t-a(t)/n(t),u=Math.abs(l)-Math.abs(t);t=l,Math.abs(u)<1e-12?o=!0:s>1e4&&(t=null,o=!0),s++}return t}(Number(t))},quad:function(e,t,i){var n=function(e,t,i,n){return r.parse("-("+t+"+"+n+"*sqrt(("+t+")^2-4*("+e+")*("+i+")))/(2*"+e+")")};return[n(e,t,i,1),n(e,t,i,-1)]},sumProd:function(e,r){return q.quad(-r,e,-1).map((function(e){return e.invert()}))},coeffs:function(e,t,i){t=String(t),e=r.expand(e),i=i||[new g(0)],e.group===a&&e.contains(t,!0)&&r.error("Unable to get coefficients using expression "+e.toString());var n=p(e);if(1!==n.length||n[0]!==t||e.isImaginary())if(t||r.error("Polynomial contains more than one variable. Please specify which variable is to be used!"),-1===n.indexOf(t))i[0]=r.add(e,i[0]);else if(i=i||[new g(0)],e.group===u){var o=e.symbols[t];o||r.error("Expression is not a polynomial!");var s=Number(o.power);((v=r.divide(e.clone(),o.clone())).contains(t,!0)||s<0||!d(s))&&r.error("Expression is not a polynomial!"),(m=i[s])&&(v=r.add(m,v)),i[s]=v}else e.group===l&&e.each((function(e){q.coeffs(e.clone(),t,i)}),!0);else for(var f=new w(e).coeffs.map((function(e){return new g(e)})),c=0,h=f.length;c<h;c++){var m,v=f[c];(m=i[c])&&(v=r.add(m,v)),i[c]=v}for(c=0,h=i.length;c<h;c++)void 0===i[c]&&(i[c]=new g(0));return i},polyPowers:function(r,i,a){if(a=a||[],(p=p=r.group)===s&&i===r.value)a=a.concat(f(r.symbols));else if(p===l)for(var o in r.symbols){var c=r.symbols[o],p=c.group,h=c.value;if(p===n&&i===h)a.push(c.power);else if(p===s||p===l)a=q.polyPowers(c,i,a);else if(p===u&&c.contains(i)){var m=c.symbols[i];m&&a.push(m.power)}else p!==t&&i===h||a.push(0)}else p===u&&r.contains(i)&&a.push(e.Utils.decompose_fn(r,i,!0).x.power);return e.Utils.arrayUnique(a).sort()},Factor:{split:function(e){var t=new g(1),i=new g(1);return q.Factor.factor(e,new M).each((function(e){var n=r.parse(e);e.isConstant(!0)?t=r.multiply(t,n):i=r.multiply(i,n)})),[t,i]},mix:function(e,r){for(var t=f(e),i=t.length,n=[],a=0;a<i;a++){for(var o=t[a],s=e[o],l=n.length,u=0;u<l;u++){var c=n[u]*o;n.push(c),r&&n.push(-c)}for(u=1;u<=s;u++)n.push(Math.pow(o,u))}return n},common:function(t,i){try{if(t.group===l){for(var n=r.expand(t.clone(),!0).collectSymbols(null,null,(function(e,r){return(r.length||1)-(e.length||1)})),a={},o=[],s=0;s<n.length;s++){var u=n[s];o.push(u.multiplier.clone()),u.each((function(e){var r=Number(e.power);if(isNaN(r))throw new Error("exiting");e.value in a?(r<a[e.value][0]&&(a[e.value][0]=r),a[e.value][1].push(e)):a[e.value]=[r,[e]]}))}var f=new g(1);for(var c in a)a[c][1].length===n.length&&(f=r.multiply(f,r.pow(new g(c),new g(a[c][0]))));var p=e.Math2.QGCD.apply(null,o);if(!p.equals(1)){i.add(new g(p));for(s=0;s<n.length;s++)n[s].multiplier=n[s].multiplier.divide(p)}if(!f.equals(1)){i.add(f),t=new g(0);for(s=0;s<n.length;s++)t=r.add(t,r.divide(n[s],f.clone()))}}}catch(e){}return t},zeroes:function(t,i){var n=function(){throw new e.exceptions.ValueLimitExceededError("Exiting")};try{var a,o,s,u,f;f=(t=r.expand(t.clone())).toString(),a=p(t),s=new g(0);for(var c=[],h=[],m=0,b=a.length;m<a.length;m++){for(var y={},w=0;w<b;w++)m!==w&&(y[a[w]]=0);var M=(o=r.parse(f,y)).power;d(M)||n(),c.push(o),h.push(o.power)}if(e.Utils.allSame(h)){var S=t.length,U=c.length;2===U&&(u=new v(h[0]/(S-1))),3===U&&(u=new v(h[0]/Math.round((Math.sqrt(8*S-1)-3)/2)))}else u=e.Math2.QGCD.apply(null,h);d(u)||n();for(m=0;m<c.length;m++){var F=c[m],x=F.power.clone().divide(u);F.multiplier=new v(Math.pow(F.multiplier,1/x)),F.power=u.clone(),s=r.add(s,F)}if(s.group!==l)return t;for(;;){var N=q.div(t.clone(),s.clone());if(!N[1].equals(0))break;if(t=N[0],i.add(s.clone()),t.equals(1))break}}catch(f){}return t},factor:function(t,i){if(t.isConstant())return e.Math2.factor(t);var n=r.parse(t),a=q.Factor._factor(n,i);if(a.equals(t))return a;if(a.group===u){var o=new g(1),s=r.parse(a.power),l=r.parse(a.multiplier);a.toUnitMultiplier(),a.multiplier.lessThan(0)&&(o.negate(),a.negate()),a.each((function(e){var t=r.parse(q.Factor._factor(e));t.group===u?(l=r.multiply(l,g.create(t.multiplier)),t.each((function(e){var t=r.parse(q.Factor._factor(e));o=r.multiply(o,t),t.group===u&&(l=r.multiply(l,g.create(t.multiplier)))}))):o=r.multiply(o,t)})),a=r.pow(r.multiply(l,o),s)}return a},quadFactor:function(t,i){if(t.isPoly()&&q.degree(t.equals(2))){var n=e.Utils.variables(t)[0],a=q.coeffs(t,n),o=q.Factor._factor(a[2].clone());if(o.group===u){var s=o.collectSymbols();if(s.length>2)return t;var l=r.multiply(r.parse(a[0]),r.parse(s[0])),f=r.parse(a[1]).negate(),c=r.parse(s[1]),p=q.quad(c,f,l).filter((function(r){if(e.Utils.isInt(r))return r}));if(1===p.length){var m=p[0],v=r.divide(a[0],r.parse(m));e.Utils.isInt(v)&&(i.add(r.parse(h("({0})*({1})+({2})",s[1],n,v))),i.add(r.parse(h("({0})*({1})+({2})",s[0],n,m))),t=new g(1))}}}return t},cubeFactor:function(e,t){if(e.isComposite()){var i=e.collectSymbols();if(2===i.length){var n=i[0].sign(),a=i[0].clone().abs(),o=i[1].sign(),s=i[1].clone().abs();if(a.isCube()&&s.isCube()){n<o&&([n,o]=[o,n],[a,s]=[s,a]);var l=r.parse(a.getNth(3)),u=r.parse(s.getNth(3)),f=r.multiply(r.expand(r.pow(a.clone().toUnitMultiplier(),r.parse("1/3"))),l),c=r.multiply(r.expand(r.pow(s.clone().toUnitMultiplier(),r.parse("1/3"))),u);1===n&&-1===o?(t.add(r.parse(h("(({0})-({1}))",f,c))),t.add(r.parse(h("(({0})^2+({0})*({1})+({1})^2)",f,c))),e=g(1)):1===n&&1===o&&(t.add(r.parse(h("(({0})+({1}))",f,c))),t.add(r.parse(h("(({0})^2-({0})*({1})+({1})^2)",f,c))),e=g(1))}}}return e},_factor:function(t,i){t.group;if(t.group===o){var a=t.args[0];if(a.group===n&&a.isSimple())return t}else if(t.group===n&&t.isSimple())return t;if(t.group===l){t.distributeMultiplier(!0);var s=new g(0);t.each((function(e){(e.group===l&&e.power.greaterThan(1)||e.group===u)&&(e=r.expand(e)),s=r.add(s,e)})),s.power=t.power,t=s}t.group===o&&"sqrt"!==t.fname&&(t=e.Utils.evaluate(t));var h=t.clone();try{if(t.group===u){var m,v,b,y,w,S,U=r.parse(t.power);if(m=q.Simplify.strip(t.getDenom()),v=q.Simplify.strip(t.getNum()),b=m.pop(),(y=v.pop()).equals(t))return t;S=q.Factor.factor(y),w=q.Factor.factor(b);var F=q.Simplify.unstrip(v,S),x=q.Simplify.unstrip(m,w);return j=r.divide(F,x)}if(t.group===n)return t;if(t.isConstant())return t.equals(1)?t.clone():e.Math2.factor(t);U=t.power.clone();if(d(U)&&(!U.lessThan(0)||t.group!==o)){var N=U.sign();t.toLinear(),i=i||new M;var C={};t=r.parse(e.Utils.subFunctions(t,C)),f(C).length>0&&(i.preAdd=function(t){return r.parse(t,e.Utils.getFunctionsSubs(C))}),t.isLinear()||(i.pFactor=t.power.toString(),t.toLinear());var A=p(t);t.isImaginary()&&A.push(e.Settings.IMAGINARY);var E=A.length>1;if(E){var D=!0,P=!0;if(t.each((function(e){e.group!==n&&(D=!1),e.multiplier.equals(1)||(P=!1)})),D&&P)return r.pow(r.parse(t,e.Utils.getFunctionsSubs(C)),r.parse(U))}var k=new M;t=q.Factor.coeffFactor(t,k),k.each((function(e){c(U)&&e.lessThan(0)&&e.negate(),N<0&&e.invert(),i.add(e)}));var T=new M;if(t=q.Factor.powerFactor(t,T),T.each((function(e){N<0&&e.invert(),i.add(e)})),E)t=q.Factor.cubeFactor(t,i),t=q.Factor.mfactor(t,i),i.each((function(e){N<0&&e.power.negate()}));else{var I=A[0];t=q.Factor.squareFree(t,i,I);var L=new M;t=q.Factor.trialAndError(t,L,I);var R=L.toSymbol();if(R.equals(h))return R;for(var V in L.factors){var _=L.factors[V];i.add(r.pow(_,r.parse(U)))}t.equals(h)&&(t=q.Factor.quadFactor(t,i))}t=r.parse(t,e.Utils.getFunctionsSubs(C));var z=1===i.length;i.add(r.pow(t,r.parse(U)));var j=i.toSymbol();return z&&t.equals(1)&&j.isLinear()&&(j=r.pow(j,r.parse(U))),j}return t}catch(e){return h}},reduce:function(e,t){if(e.group===l&&2===e.length){var i=e.collectSymbols().sort((function(e,r){return r.multiplier-e.multiplier}));if(i[0].power.equals(i[1].power)){var n=r.parse(i[0].power),a=i[0].clone().toLinear(),o=i[1].clone().toLinear();t.add(r.add(a.clone(),o.clone())),o.negate();for(var s=Number(n),u=new g(0),f=1;f<=s;f++){var c=r.pow(a.clone(),r.subtract(n.clone(),new g(f))),p=r.pow(o.clone(),r.subtract(new g(f),new g(1)));u=r.add(u,r.multiply(c,p))}return u}}return e},squareFree:function(e,r,t){if(e.isConstant()||e.group===n)return e;var i=new w(e,t).squareFree(),a=i[2];if(1!==a){var o=i[1].toSymbol();return o.power=o.power.multiply(new v(a)),r.add(q.Factor.factor(o)),q.Factor.squareFree(i[0].toSymbol(),r)}return e},powerFactor:function(t,i){if(t.group!==s||t.previousGroup===a)return t;var n=f(t.symbols);if(!e.Utils.allNumeric(n))return t;var o=e.Utils.arrayMin(n),l=new g(0),u=r.parse(t.value+"^"+o);return t.each((function(e){e=r.divide(e,u.clone()),l=r.add(l,e)})),i.add(u),l},coeffFactor:function(r,t){if(r.isComposite()){var i=e.Math2.QGCD.apply(null,r.coeffs());if(i.equals(1)){var n=function(e){var r;return e.group===u?(r=0,e.each((function(e){r+=e.power}))):r=Number(e.power),r},a=r.collectSymbols(null,null,null,!0).sort((function(e,r){return e.isConstant(!0)?1:r.power-e.power})),o=a[0];(n(o)>n(a[1])||a[1].isConstant(!0))&&o.multiplier.lessThan(0)&&(t.add(new g(-1)),r.each((function(e){e.negate()}),!0))}else r.each((function(e){e.isComposite()?e.each((function(e){e.multiplier=e.multiplier.divide(i)})):e.multiplier=e.multiplier.divide(i)})),r.updateHash();t&&t.add(new g(i))}return r},trialAndError:function(r,t,i){var a=r.clone();try{var o=[];if(r.isConstant()||r.group===n)return r;for(var s=new w(r,i),l=s.coeffs[0],u=e.Math2.ifactor(l),f=q.proots(r),c=0;c<f.length;c++){var p=f[c],h=1;if(!isNaN(p)){for(var m in u){var g=e.Utils.round(Math.log(m)/Math.log(Math.abs(p)),8);if(d(g)){p=m,h=g;break}}var b=new v(p),y=[new v(b.num).negate()];y[h]=new v(b.den);var M=w.fromArray(y,s.variable).fill(),S=s.divide(M);S[1].equalsNumber(0)&&(s=S[0],o.push(M.toSymbol()))}}return s.equalsNumber(1)||(s=q.Factor.search(s,t)),o.forEach((function(e){t.add(e)})),s.toSymbol()}catch(e){return a}},search:function(r,t,i){i=i||10;var n=r.variable,a=function(e,a,o,s){var l=w.fit(e,a,o,i,s,n);if(l&&l.coeffs.length>1){var u=r.divide(l);if(u[1].equalsNumber(0))return t.add(l.toSymbol()),[u[0],l]}return null},o=r.coeffs[0],s=e.Math2.ifactor(o),l=r.lc(),u=e.Math2.ifactor(l),f=r.sub(i),c=e.Math2.ifactor(f),p=q.Factor.mix(c,f<0),h=Math.ceil(r.coeffs.length/2),m=l.lessThan(0),v=o.lessThan(0);for(u[1]=1,s[1]=1;h--;)for(var d in u)for(var g in s)for(var b=0;b<p.length;b++){var y=a(d,g,p[b],h);if(y)return r=y[0],e.Utils.isPrime(r.sub(i))||(r=q.Factor.search(r,t)),r;y||(m&&v?y=a(-d,-g,p[b],h):m?y=a(-d,g,p[b],h):v&&(y=a(d,-g,p[b],h)))}return r},mSqfrFactor:function(r,t){if(r.group!==o)for(var i=p(r).reverse(),n=0;n<i.length;n++)do{if(i[n]!==r.value){var a=e.Calculus.diff(r,i[n]),s=q.Factor.coeffFactor(a);if(s.equals(0))break;var l=!0;if(s.isConstant()&&r.isComposite()&&r.each((function(e){e.multiplier%s!=0&&(l=!1)}),!0),l){var u=q.div(r,s.clone()),f=u[1].equals(0);if(r.equals(u[0])&&u[1].equals(0))break;if(u[0].isConstant()){t.add(u[0]);break}}else f=!1;f&&(t.add(u[0]),r=s)}else t.add(r),r=new g(1)}while(f);return r},sqdiff:function(t,i){if(t.isConstant("all"))return t;try{var a=function(r){return e.Utils.block("POSITIVE_MULTIPLIERS",(function(){return g.unwrapPARENS(y.sqrt(y.abs(r)))}),!0)},o=e.Utils.separate(t.clone()),s=[];for(var l in o)"constants"!==l&&s.push(o[l]);if(s.sort((function(e,r){return r.power-e.power})),2===s.length){var u,f;if(u=s.pop(),f=s.pop(),c(u.power)&&c(f.power)&&u.sign()===f.sign()&&u.group===n&&f.group===n)throw new Error("Unable to factor");if(u.isComposite()&&f.power.equals(2)){f=a(f);var p=q.Factor.factor(r.add(u,o.constants));p.power.equals(2)&&(p.toLinear(),i.add(r.subtract(p.clone(),f.clone())),i.add(r.add(p,f)),t=new g(1))}else if(u=u.powSimp(),f=f.powSimp(),(u.group===n||""===u.fname)&&u.power.equals(2)&&(f.group===n||""===f.fname)&&f.power.equals(2)&&!o.constants){if(u.multiplier.lessThan(0)){var h=f;f=u,u=h}u.multiplier.greaterThan(0)&&(u=a(u),f=a(f)),i.add(r.subtract(u.clone(),f.clone())),i.add(r.add(u,f)),t=new g(1)}}}catch(e){}return t},mfactor:function(t,i){if(t.group===o)if("sqrt"===t.fname){var n=new M,a=q.Factor.common(t.args[0].clone(),n);a=q.Factor.coeffFactor(a,n),t=r.multiply(r.symfunction("sqrt",[a]),r.parse(t.multiplier)),n.each((function(i){t=r.multiply(t,r.parse(e.Utils.format("sqrt({0})",i)))}))}else i.add(t);else{t=q.Factor.mSqfrFactor(t,i);for(var s=p(t),l=t.collectSymbols().map((function(e){return g.unwrapSQRT(e)})),u={},f={},c=s.length,h=l.length,m=0;m<c;m++){var v=s[m];u[v]=new g(0);for(var b=0;b<h;b++){var y=l[b];if(y.contains(v)){var w=y.value===v?y.power.toDecimal():y.symbols[v].power.toDecimal();(!f[v]||w<f[v])&&(f[v]=w),u[v]=r.add(u[v],y.clone())}}}for(var S in u){var U=r.parse(S+"^"+f[S]),F=r.divide(u[S],U),x=r.expand(F);if(x.equals(1))break;var N=q.div(t.clone(),x);if(N[0].equals(0))break;if(N[1].equals(0)){var C=!1;if(N[0].each((function(e){d(e.multiplier)||(C=!0)})),C){N[1]=r.expand(r.multiply(N[1],x));break}}var A=d(x)&&x.lessThan(0);if(N[1].equals(0)&&!A){var E=q.div(t.clone(),N[0].clone());if((U=E[0]).equals(0))return t;if(t=E[1],U.equals(-1)&&!t.equals(0))return t;var D=N[0];if(t.equals(D)){var P=q.Factor.reduce(D,i);return t.equals(P)?P:q.Factor.mfactor(P,i)}return i.add(D),t.equals(0)?U:U.isConstant("all")?(i.add(U),U):q.Factor.mfactor(U,i)}}}return t=q.Factor.sqdiff(t,i),t=q.Factor.zeroes(t,i)}},allLinear:function(e){for(var r=e.length,t=0;t<r;t++)if(!q.isLinear(e[t]))return!1;return!0},isLinear:function(e){var r=!1,i=e.group;if(i===s||i===l)for(var f in r=!0,e.symbols){var c=e.symbols[f],h=c.group;if(h!==o&&h!==a||(r=!1),h===u)r=1===p(c).length;else if(h===s||h===l)r=q.isLinear(c);else if(c.group!==t&&"1"!==c.power.toString()){r=!1;break}}else i===n&&1===e.power&&(r=!0);return r},gcd:function(){var t;if(0===(t=1===arguments.length&&arguments[0]instanceof e.Vector?arguments[0].elements:e.Utils.arguments2Array(arguments)).length)return new g(1);if(1===t.length)return t[0];for(var i=[],n=!1,a=0;a<t.length;a++)if(t[a].group===o&&"gcd"===t[a].fname)(t=t.concat(arguments[a].args)).splice(a,1);else{var s=p(t[a]);if(e.Utils.haveIntersection(s,i)){n=!0;break}i=i.concat(s)}if(n||0===i.length){if(t.every((function(e){return e.getDenom().equals(1)}))){var l=t[0];for(a=1;a<t.length;a++)l=q.gcd_(t[a],l);return l}return r.divide(q.gcd.apply(null,t.map((function(e){return e.getNum()}))),q.lcm.apply(null,t.map((function(e){return e.getDenom()}))))}return r.symfunction("gcd",t)},gcd_:function(t,n){if(t.group!==o&&t.group!==i||(t=e.Utils.block("PARSE2NUMBER",(function(){return r.parse(t)}))),n.group===o&&(n=e.Utils.block("PARSE2NUMBER",(function(){return r.parse(n)}))),t.isConstant()&&n.isConstant())return new g(e.Math2.QGCD(new v(+t),new v(+n)));var s=r.multiply(t.getDenom()||new g(1),n.getDenom()||new g(1)).invert();if(t=r.multiply(t.clone(),s.clone()),n=r.multiply(n.clone(),s.clone()),t=r.expand(t),n=r.expand(n),t.group===u||n.group===u){var l=r.divide(t.clone(),n.clone());if(!(m=r.multiply(n.clone(),l.getDenom().invert())).equals(1))return m}if(t.group===a||n.group===a){var f=new g(e.Math2.GCD(t.multiplier,n.multiplier)),c=q.gcd_(t.value===b?new g(1):r.parse(t.value),n.value===b?new g(1):r.parse(n.value)),h=q.gcd_(r.parse(t.power),r.parse(n.power));return r.multiply(f,r.pow(c,h))}if(t.length<n.length){var m=t;t=n,n=m}var d=p(t),y=p(n);if(d.length===y.length&&1===d.length&&d[0]===y[0]||1===d.length&&0===y.length||0===d.length&&1===y.length)return t=new w(t),n=new w(n),r.divide(t.gcd(n).toSymbol(),s);var M,S=[];for(t.each((function(e){S.push(e.multiplier)})),n.each((function(e){S.push(e.multiplier)}));!n.equals(0);){m=n.clone();if(t=t.clone(),M=q.div(t,m),n=M[1],M[0].equals(0))return r.divide(new g(e.Math2.QGCD(t.multiplier,n.multiplier)),s);t=m}var U=e.Math2.QGCD.apply(void 0,S);return U.equals(1)||t.each((function(e){e.multiplier=e.multiplier.divide(U)})),!t.equals(1)||t.isConstant()||n.isConstant()?r.divide(t,s):r.divide(r.symfunction("gcd",arguments),s)},lcm:function(){var t;1===arguments.length?arguments[0]instanceof e.Vector?t=arguments[0].elements:r.error("lcm expects either 1 vector or 2 or more arguments"):t=e.Utils.arguments2Array(arguments);var i,n=t.reduce((function(e,t){return r.multiply(e,t.clone())}),new g(1)),a=function(e,r){r=Number(r);var t,i,n,a=[],o=Math.pow(2,e.length);for(i=r;i<o;i++){t=[],n=e.length-1;do{0!=(i&1<<n)&&t.push(e[n])}while(n--);t.length===r&&a.push(t)}return a}(arguments,arguments.length-1).map((function(e){return e.reduce((function(e,t){return r.multiply(e,t.clone())}),new g(1))}));i=t.every((function(r){return e.Utils.isVariableSymbol(r)}))?r.symfunction("gcd",e.Utils.arrayUnique(a)):q.gcd.apply(null,a);var o=r.divide(n,i);return o},divide:function(t,i){var n,a,o,s;return(s=(o=e.Algebra.Factor.factor(t.clone())).getDenom()).isConstant("all")?s=new g(1):t=r.expand(g.unwrapPARENS(r.multiply(o,s.clone()))),n=q.div(t,i),a=r.divide(n[1],i),r.divide(r.add(n[0],a),s)},div:function(t,i){var a,o,s=[new g(0),t.clone()];try{if(i.isConstant("all"))return t.each((function(e){e.multiplier=e.multiplier.divide(i.multiplier)})),[t,new g(0)];if(t=r.expand(t),i=r.expand(i),t.group===n&&i.group===l){var u=t.value,f=e.Utils.decompose_fn(i.clone(),u,!0);if(t.isLinear()&&f.x&&f.x.isLinear()&&i.isLinear()){var c=g.create(t.multiplier);return[r.divide(c.clone(),f.a.clone()),r.divide(r.multiply(c,f.b),f.a).negate()]}}if(t.group===n&&i.group===n){var h=r.divide(t.clone(),i.clone());return h.isConstant()?[h,new g(0)]:[new g(0),t.clone()]}var m=t.hasFunc(),d=i.hasFunc(),y=!1;if(m||d){y=!0;var M={},q=(t=r.parse(e.Utils.subFunctions(t,M)),i=r.parse(e.Utils.subFunctions(i,M)),e.Utils.getFunctionsSubs(M))}var U,F,x=e.Utils.arrayUnique(p(t).concat(p(i)));if((t.isImaginary()||i.isImaginary())&&x.push(e.Settings.IMAGINARY),1===x.length){U=(Y=new w(t).divide(new w(i)))[0].toSymbol(),F=Y[1].toSymbol()}else{x.push(b);var N=function(e){for(var t=new g(0),i=0;i<e.length;i++){var n=e[i].toSymbol();t=r.add(t,n)}return t},C=function(e,r){var t,i=Math.max.apply(null,e.terms),n=0;if(!r)for(var a=0;a<e.terms.length;a++)if(e.terms[a].equals(i)&&(t=a,n++),n>1)return;if(r)for(a=0;a<e.terms.length;a++)if(e.terms[a].equals(i)){t=a;break}return[i,t,e]},A=function(e,r){var t=e[r=r||0],i=e.length;if(t){for(var n,a,o=C(t),s=r+1;s<i;s++){var l=e[s],u=t.sum.equals(l.sum);if(!u&&o)break;if(u){for(var f,c,p,h,m=t.terms.length,v=0;v<m;v++){var d=t.terms[v],g=l.terms[v];(void 0===f||d.greaterThan(f))&&(f=d,p=v),(void 0===c||g.greaterThan(c))&&(c=g,h=v)}var b=f.subtract(l.terms[p]),y=c.subtract(t.terms[h]);if(y>b){o=[c,h,l];break}if(b>y){o=[f,p,t];break}}else if(o=C(l))break;o=C(l)}if(!o)return C(e[0],!0);for(s=0;s<T.length;s++){var w=T[s].terms;if((a=o[1])===w.length-1)return;if(!(n=w[a]).equals(0))break}return n.equals(0)?A(e,++r):o}},E=e.Utils.toMapObj(x),D=function(e,r){return r.sum.subtract(e.sum)},P=function(e,r){if(!e||!r)return!1;for(var t=0;t<e.terms.length;t++)if(e.terms[t].lessThan(r.terms[t]))return!1;return!0},k=t.tBase(E).sort(D),T=i.tBase(E).sort(D),I=P(k[0],T[0])&&k[0].count>T[0].count?T:k,L=A(I),R=[];if(L){var V=L[1],_=function(e,r){var t=e.len(),i=r.len(),n=r.terms[V],a=e.terms[V];return i>t&&n.greaterThan(a)?i-t:n.subtract(a)};V=function(e,r,t){for(var i=[],n=0;n<e.length;n++)for(var a=e[n],o=0;o<a.terms.length;o++){var s=i[o],l=a.terms[o];0===n?i[o]=l:s&&!s.equals(l)&&(i[o]=void 0)}for(n=0;n<i.length;n++){if((a=i[n])&&!a.equals(0))return n}return t}(k,0,V),k.sort(_),T.sort(_);var z=T[0],j=k[0],O=new S(new v(1),[],j.map);if(z.sum.greaterThan(j.sum)&&j.len()>1)for(var Z=0;Z<j.terms.length;Z++){var G=z.terms[Z].subtract(j.terms[Z]);if(G.equals(0))O.terms[Z]=new v(0);else{var B=G.add(new v(1));O.terms[Z]=G;for(var H=0;H<k.length;H++)k[H].terms[Z]=k[H].terms[Z].add(B)}}for(var Q=P(k[0],T[0]),X=0;Q&&(o=T,!(a=k)[0].sum.equals(o[0].sum)||a.length>=o.length);){if(X++>200)throw new e.exceptions.InfiniteLoopError("Unable to compute!");var Y=k[0].divide(T[0]);R.push(Y),k.shift();for(Z=1;Z<T.length;Z++){var J=T[Z].multiply(Y).generateImage(),K=k.length;0===K&&(J.coeff=J.coeff.neg(),k.push(J),k.sort(_));for(H=0;H<K;H++){var W=k[H];if(W.getImg()===J.getImg()){W.coeff=W.coeff.subtract(J.coeff),W.coeff.equals(0)&&(e.Utils.remove(k,H),H--);break}H===K-1&&(J.coeff=J.coeff.neg(),k.push(J),k.sort(_))}}if(!(Q=P(k[0],T[0]))&&k.length>=T.length)for(Z=1;Z<k.length;Z++)if(Q=P(k[Z],T[0])){k.unshift(e.Utils.remove(k,Z));break}}}U=N(R),F=N(k),void 0!==O&&(O=O.toSymbol(),U=r.divide(U,O.clone()),F=r.divide(F,O))}return y&&(U=r.parse(U.text(),q),F=r.parse(F.text(),q)),[U,F]}catch(e){return s}},line:function(t,i,n){e.Utils.isArray(t)&&(t=e.Utils.convertToVector(t)),e.Utils.isArray(i)&&(i=e.Utils.convertToVector(i)),n=r.parse(n||"x"),e.Utils.isVector(t)&&e.Utils.isVector(i)||r.error('Line expects a vector! Received "'+t+'" & "'+i+'"');var a=r.subtract(i.e(1).clone(),t.e(1).clone()),o=r.subtract(i.e(2).clone(),t.e(2).clone()),s=r.divide(o,a),l=r.multiply(n,s.clone()),u=r.multiply(t.e(1).clone(),s);return r.add(r.subtract(l,u),t.e(2).clone())},PartFrac:{createTemplate:function(e,t,i,a){var s,l,u,f,c,p,h;(e=q.Factor.factor(e)).each((function(r,t){if(r.group===o&&""===r.fname&&r.args[0].group===n){var i=r.args[0];this.symbols?(delete this.symbols[t],this.symbols[i.value]=i):e=r.args[0]}})),s=t.collectFactors(),l=[],p=[],h=new g(1);for(var m=0;m<s.length;m++){var v=g.unwrapPARENS(s[m]);if(v.power.greaterThan(1)){f=Number(v.power),u=v.clone().toLinear(),c=Number(q.degree(u,a));for(var d=0;d<f;d++){var b=r.pow(u.clone(),new g(d+1));i.push(b.clone());var y=r.divide(e.clone(),b.clone());p.push(c),l.push(y)}}else{c=Number(q.degree(v,a)),i.push(v);y=r.divide(e.clone(),v.clone());y=r.expand(g.unwrapPARENS(y)),p.push(c),l.push(y)}}return[i=i.map((function(e){return r.multiply(e,h.clone())})),l,p]},partfrac:function(t,i,n){var a=p(t);i=i||r.parse(a[0]);try{var o,s,l,u,f,c,h,m,v,d,b,y,w,M,S,U,F,x,N;if(o=r.expand(t.getNum()),s=r.expand(t.getDenom().toUnitMultiplier()),o.multiplier=t.multiplier,f=o.groupTerms(i),Number(q.degree(o,i))>=Number(q.degree(s,i))?(w=(y=q.div(o.clone(),r.expand(s.clone())))[0],f=(o=y[1]).groupTerms(i)):w=new g(0),1===Number(q.degree(s,i))){var C=r.divide(o,s);return n?[w,C]:r.add(w,C)}u=q.Factor.factor(s),U=q.PartFrac.createTemplate(s.clone(),u,[],i),F=U[0],M=U[1],c=U[2],b=[f.length],h=[],l=[],S=[],M.map((function(e,t){x=F[t],N=c[t];for(var n=0;n<N;n++){l.push(x.clone());var a=g.create(i,n),o=r.expand(r.multiply(e,a.clone())).groupTerms(i),s=o.length;b.push(s),h.push(o),S.push(a.clone())}})),m=e.Utils.arrayMax(b),d=new e.Matrix(e.Utils.fillHoles(f,m)).transpose(),v=new e.Matrix;for(var A=0;A<h.length;A++)v.elements.push(e.Utils.fillHoles(h[A],m));var E=r.multiply(v.transpose().invert(),d),D=n?[w]:w;return E.each((function(e,t){var i=r.multiply(S[t],r.divide(e,l[t]));n?D.push(i):D=r.add(D,i)})),D}catch(e){try{if(t.isComposite()){var P={};t.each((function(e){var t=e.getDenom(),i=e.getNum(),n=P[t];P[t]=n?r.add(n,i):i}));var k=new g(0);for(var T in P)k=r.add(k,r.divide(P[T],r.parse(T)));t=k}}catch(e){}}return t}},degree:function(t,i,o){if(o=o||{nd:[],sd:[],depth:0},!i){var s=p(t);if(s.length>1)throw new Error("You must specify the variable for multivariate polynomials!");if(0===s.length)return new g(0);i=r.parse(s[0])}var l=t.group;t.isComposite()?((t=t.clone()).distributeExponent(),t.each((function(e){o.depth++,q.degree(e,i,o),o.depth--}))):t.group===u?t.each((function(e){o.depth++,q.degree(e,i,o),o.depth++})):l===a&&t.value===i.value?o.sd.push(t.power.clone()):l===n&&t.value===i.value?o.nd.push(r.parse(t.power)):o.nd.push(new g(0));var f=o.nd.length>0?e.Utils.arrayMax(o.nd):void 0;return 0===o.depth&&o.sd.length>0?(void 0!==f&&o.sd.unshift(f),r.symfunction("max",o.sd)):(e.Utils.isSymbol(f)||(f=r.parse(f)),f)},sqComplete:function(t,i,n){e.Utils.isSymbol(i)||(i=r.parse(i));var a,o,s,l,u,f,c,p,h,m,v,d=function(r){throw r=r||"Stopping",new e.exceptions.ValueLimitExceededError(r)};return t.isPoly(!0)||d("Must be a polynomial!"),h=e.Utils.inBrackets,t=t.clone(),(a=e.Algebra.degree(t,i)).equals(2)||d("Cannot complete square for degree "+a),o=(c=e.Algebra.coeffs(t,i))[2],p=c[1].sign(),s=r.divide(c[1],new g(2)),l=r.pow(s.clone(),new g(2)),n?[o,s,u]:(v=y.sqrt(o),f=r.divide(y.sqrt(l),v.clone()),u=r.subtract(c[0],r.pow(f.clone(),new g(2))),{a:m=r.parse(h(v.clone()+"*"+i+(p<0?"-":"+")+f)),c:u,f:r.add(r.pow(m.clone(),new g(2)),u.clone())})},Simplify:{strip:function(e){var t=r.parse(e.multiplier);e.toUnitMultiplier();var i=r.parse(e.power);return e.toLinear(),[t,i,e]},unstrip:function(e,t){var i=e[0],n=e[1];return r.multiply(i,r.pow(t,n))},complexSimp:function(e,t){var i,n,a,o,s,l,u,f,c;return l=e.realpart(),f=e.imagpart(),u=t.realpart(),c=t.imagpart(),i=r.multiply(l.clone(),u.clone()),n=r.multiply(f.clone(),c.clone()),a=r.multiply(u.clone(),f),o=r.multiply(l,c.clone()),s=r.add(r.pow(u,new g(2)),r.pow(c,new g(2))),r.divide(r.add(r.add(i,n),r.multiply(r.subtract(a,o),g.imaginary())),s)},trigSimp:function(t){if(t.containsFunction(["cos","sin","tan"])){t=t.clone();var i=q.Simplify.strip(t),n=(t=i.pop()).clone();if(t.group===l){var a=new g(0);t.each((function(e){var t=q.Simplify.trigSimp(e.fnTransform());a=r.add(a,t)}),!0),n=r.pow(r.multiply(new g(t.multiplier),a),new g(t.power))}else if(t.group===u){var o=t.getNum(),s=t.getDenom();if("sin"===o.fname&&"cos"===s.fname&&o.args[0].equals(s.args[0])&&o.power.equals(s.power)&&(n=r.parse(e.Utils.format("({0})*({1})*tan({2})^({3})",s.multiplier,o.multiplier,o.args[0],o.power))),n.group===u){var f=new g(1);n.each((function(t){"tan"===t.fname&&(t=r.parse(e.Utils.format("({0})*sin({1})^({2})/cos({1})^({2})",t.multiplier,q.Simplify.simplify(t.args[0]),t.power))),f=r.multiply(f,t)})),n=f}}t=n=q.Simplify.unstrip(i,n).distributeMultiplier()}return t},fracSimp:function(e){var t=e.getDenom();if((m=e.getNum()).isImaginary()&&t.isImaginary()&&(e=q.Simplify.complexSimp(m,t)),e.isComposite()){e.power>1&&(e=r.expand(e));var i,n,a,o,s,l,u,f,c,p,h,m,v=e.collectSymbols();for(n=v.pop();v.length;)a=v.pop(),o=r.parse(n.getDenom()),s=r.parse(a.getDenom()),l=n.getNum(),u=a.getNum(),h=r.multiply(o.clone(),s.clone()),c=r.multiply(l,s),p=r.multiply(u,o),f=r.add(c,p),n=r.divide(f,h);return t=r.expand(n.getDenom()),(i=(m=r.expand(n.getNum())).isImaginary()&&t.isImaginary()?q.Simplify.complexSimp(m,t):r.divide(m,t)).equals(e)?e:q.Simplify.simplify(i)}return e},ratSimp:function(e){if(e.group===u){var t=e.getDenom(),i=e.getNum().distributeMultiplier(),n=q.Simplify.fracSimp(t),a=q.Simplify.fracSimp(i);e=r.divide(a,n)}return e},sqrtSimp:function(e,i){if(e.isSQRT()){var n,a=q.Factor.factor(e.args[0].clone()),o=r.parse(a.multiplier),s=o.sign(),l=r.sqrt(o.abs());if(d(l)){if(a.group===u){var f=new g(1);a.each((function(e){if(e.group===t){var i=r.sqrt(e.clone());d(i)?l=r.multiply(l,i):f=r.multiply(f,e)}else f=r.multiply(f,e)}));var c=r.multiply(f,r.parse(s));(n=r.sqrt(c.clone())).isImaginary&&(n=r.sqrt(r.expand(c.clone())))}else n=r.sqrt(a.clone().toUnitMultiplier());return r.multiply(l,n)}}else e.isComposite()&&e.isLinear()?(l=new g(0),e.each((function(e){l=r.add(l,q.Simplify.sqrtSimp(e))}),!0),l=r.multiply(l,r.parse(e.multiplier))):e.group===u&&(l=r.parse(e.multiplier),e.each((function(e){var t=q.Simplify.sqrtSimp(e);l=r.multiply(l,t)}),!0),l=r.pow(l,r.parse(e.power)));return l||r.parse(e)},patternSub:function(r){var t={},i=function(e){var r=!1;return e.each((function(e){e.group===l?r=!0:e.symbols&&(r=i(e))})),r},n=function(a){a.each((function(a){if(a.symbols||a.group===o)if(i(a))n(a);else if(!t[a.value]){var s=e.Utils.getU(r);t[a.value]=s,r=r.sub(a.value,s)}}),!0)};return n(r),[r,t]},simplify:function(t){var i=q.Simplify.strip(t);if(t=i.pop(),(t=q.Simplify.fracSimp(t)).isConstant()||t.group===e.groups.S)return i.push(t),q.Simplify.unstrip(i,t);var n=t.clone();if(n=q.Simplify.trigSimp(n),n=q.Simplify.ratSimp(n),(n=q.Factor.factor(n)).group===e.groups.CP&&n.isLinear()){var a=n.multiplier.clone();n.toUnitMultiplier();var o=new g(0);n.each((function(e){var t=q.Simplify.simplify(e);o=r.add(o,t)})),n=o,o.multiplier=o.multiplier.multiply(a)}return q.Simplify.unstrip(i,n)}},Classes:{Polynomial:w,Factors:M,MVTerm:S}};e.Expression.prototype.simplify=function(){return q.Simplify.simplify(this.symbol)},nerdamer.useAlgebraDiv=function(){var t=q.divideFn=r.divide,i=0;r.divide=function(r,n){var a;return a=1===++i?e.Algebra.divide(r,n):t(r,n),i=0,a}},nerdamer.useParserDiv=function(){q.divideFn&&(r.divide=q.divideFn),delete q.divideFn},nerdamer.register([{name:"factor",visible:!0,numargs:1,build:function(){return q.Factor.factor}},{name:"simplify",visible:!0,numargs:1,build:function(){return q.Simplify.simplify}},{name:"gcd",visible:!0,numargs:[1],build:function(){return q.gcd}},{name:"lcm",visible:!0,numargs:[1],build:function(){return q.lcm}},{name:"roots",visible:!0,numargs:-1,build:function(){return q.roots}},{name:"divide",visible:!0,numargs:2,build:function(){return q.divide}},{name:"div",visible:!0,numargs:2,build:function(){return q.div}},{name:"partfrac",visible:!0,numargs:[1,2],build:function(){return q.PartFrac.partfrac}},{name:"deg",visible:!0,numargs:[1,2],build:function(){return q.degree}},{name:"coeffs",visible:!0,numargs:[1,2],build:function(){return function(){var r=q.coeffs.apply(q,arguments);return new e.Vector(r)}}},{name:"line",visible:!0,numargs:[2,3],build:function(){return q.line}},{name:"sqcomp",visible:!0,numargs:[1,2],build:function(){return function(e,r){try{return r=r||p(e)[0],q.sqComplete(e.clone(),r).f}catch(r){return e}}}}]),nerdamer.updateAPI()}();
